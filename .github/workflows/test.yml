name: test

run-name: ${{ github.actor }} is a test flow

on: [push]

jobs:
  checkout-repository:
    runs-on: self-hosted
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3

#  build-rgl-host:
#    needs: checkout-repository
#    runs-on: self-hosted
#    steps:
#      - run: ./setup.py --build-dir build-host

  build-rgl-docker:
    needs: checkout-repository
    runs-on: self-hosted
    container:
      image: docker://localhost:5000/rgl:latest
      env:
        OptiX_INSTALL_DIR: /optix
        NVIDIA_DRIVER_CAPABILITIES: all
#      volumes:
#        - ${{ env.OptiX_INSTALL_DIR }}:/optix
      options:
        --rm
        --name rgl
        --gpus all
        --volume ${{ env.OptiX_INSTALL_DIR }}:/optix
    steps:
      - run: pwd
      - run: ls
      - run: echo $OptiX_INSTALL_DIR
      - run: ./setup.py --build-dir build-docker
